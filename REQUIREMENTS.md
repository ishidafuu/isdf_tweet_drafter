# 📋 Voice2Tweet Bot - 要件定義書

## 📌 ドキュメント情報
- **作成日**: 2025-11-30
- **バージョン**: 1.0 (MVP)
- **ステータス**: 要件定義完了・実装前

---

## 1. システム概要

### 1.1 プロジェクト名
**Voice2Tweet Bot (MVP版)**

### 1.2 目的
スマートフォンの音声入力で書き殴ったテキストを、AI（Gemini API）を用いて自動的にX（旧Twitter）投稿用に整形し、ワンタップでXアプリを起動して投稿できる仕組みを提供する。

### 1.3 背景
- 音声入力は便利だが、誤字脱字や冗長な表現が多く、SNS投稿には不向き
- 手動での編集作業は面倒で、投稿のハードルが上がる
- 自動整形とワンタップ投稿で、思いついたアイデアを即座にシェアできる環境を実現

### 1.4 対象ユーザー
- 個人利用者（開発者本人）
- 音声入力を活用してX（Twitter）に投稿したい人

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 メッセージ受信機能
- **目的**: Discordのメッセージを受信し、処理対象のテキストを取得する
- **詳細**:
  - Bot が参加しているサーバーのチャンネル、またはDMでメッセージを受信
  - Bot 自身のメッセージは無視する（無限ループ防止）
  - すべてのテキストメッセージを処理対象とする

#### 2.1.2 AI文章整形機能
- **使用API**: Google Gemini 2.5 Flash
- **処理内容**:
  1. **誤字脱字の修正**: 音声入力特有の誤認識を修正
  2. **自然な言い回しへの変換**: 口語的な表現を自然な文章に
  3. **140字以内への要約**: X（Twitter）の文字数制限に対応
  4. **絵文字の適度な追加**: 1〜2個程度で親しみやすさを演出

- **制約事項**:
  - ハッシュタグは付けない（ユーザーが後から追加可能）
  - 元の文脈やニュアンスを変えない
  - 結果はテキストのみを出力（説明文などは不要）

#### 2.1.3 投稿UI提供機能
- **手段**: Discord Embed + Button
- **表示内容**:
  - **整形前のテキスト**: ユーザーが入力した元のテキスト（確認用）
  - **整形後のテキスト**: AIが整形した投稿用テキスト（メイン）
  - **アクションボタン**: 「Xアプリで開く」ボタン
    - クリックすると Twitter Intent URL を開く
    - URL形式: `https://twitter.com/intent/tweet?text={URLエンコードされたテキスト}`
    - スマートフォンでは自動的にXアプリが起動する

---

## 3. 非機能要件

### 3.1 技術スタック
- **プログラミング言語**: Python 3.10 以上
- **主要ライブラリ**:
  - `discord.py`: Discord Bot の実装
  - `google-generativeai`: Gemini API のクライアント
  - `python-dotenv`: 環境変数の管理

### 3.2 セキュリティ
- API キーは `.env` ファイルで管理し、Gitにコミットしない
- `.env` ファイルは `.gitignore` に追加必須

### 3.3 パフォーマンス
- API レスポンス時間: 通常 1〜3 秒以内（Gemini API 依存）
- 同時処理: 単一ユーザー利用のため、並行処理は不要

### 3.4 可用性
- 稼働環境: ローカルマシン、またはクラウドサーバー（AWS/GCP/Heroku等）
- エラーハンドリング: API エラー時は Discord でエラーメッセージを返す

### 3.5 保守性
- コードは単一ファイル（`main.py`）で完結させ、シンプルに保つ
- システムインストラクションは変数として管理し、調整しやすくする

---

## 4. システム構成

### 4.1 ディレクトリ構造
```
isdf_tweet_drafter/
├── .env                  # 環境変数（DISCORD_TOKEN, GEMINI_API_KEY）
├── .env.example          # 環境変数のテンプレート
├── .gitignore            # Git除外設定
├── requirements.txt      # 依存ライブラリ
├── main.py               # Botのメインロジック
├── README.md             # プロジェクト概要
├── REQUIREMENTS.md       # 本ドキュメント
├── IMPLEMENTATION_PLAN.md # 実装手順書
└── CLAUDE.md             # Claude Code用プロジェクトコンテキスト
```

### 4.2 外部サービス
1. **Discord API**
   - Bot Token の取得が必要
   - Message Content Intent を有効化必須

2. **Google Gemini API**
   - Google AI Studio で API Key を取得
   - モデル: `gemini-2.5-flash`

---

## 5. ユースケース

### 5.1 基本フロー
1. ユーザーがスマホのDiscordアプリで音声入力を使ってメッセージを送信
2. Bot がメッセージを受信し、「処理中...」のリアクションを表示
3. Gemini API にテキストを送信し、整形結果を取得
4. Discord Embed で以下を表示:
   - 整形前のテキスト
   - 整形後のテキスト
   - 「Xアプリで開く」ボタン
5. ユーザーがボタンをタップ
6. Xアプリが起動し、整形済みテキストが投稿フォームに入力された状態で開く
7. ユーザーが確認後、投稿ボタンをタップして完了

### 5.2 エラーケース
- **API エラー**: Discord で「エラーが発生しました」とメッセージを返す
- **文字数超過**: 140字を超える場合は Gemini に再要約させる（システムインストラクションで制御）
- **空メッセージ**: 無視、または「テキストを入力してください」と返す

---

## 6. 成功基準

### 6.1 MVP の成功条件
- [ ] Discord でメッセージを受信できる
- [ ] Gemini API でテキストが整形される
- [ ] 整形結果が Discord Embed で表示される
- [ ] ボタンクリックで X アプリが開く
- [ ] 整形後のテキストが 140 字以内に収まる

### 6.2 品質基準
- API エラーが発生しても Bot がクラッシュしない
- 誤字修正の精度が実用レベル（主観的評価）
- レスポンスタイムが 5 秒以内

---

## 7. 今後の拡張可能性（Scope外）

以下は MVP には含めないが、将来的な拡張として検討可能:
- [ ] 複数のトーン（フォーマル/カジュアル）選択機能
- [ ] 投稿履歴の保存
- [ ] 画像添付機能
- [ ] スレッド形式での複数案の提示
- [ ] 他のSNS（Instagram, Facebook）への対応

---

## 8. 承認・変更履歴

| 日付 | バージョン | 変更内容 | 承認者 |
|------|-----------|----------|--------|
| 2025-11-30 | 1.0 | 初版作成 | - |

---

**備考**:
本ドキュメントは MVP（最小実用製品）を前提としており、過度な機能追加は避けています。
実装完了後、ユーザーフィードバックに基づいて要件を見直す予定です。
